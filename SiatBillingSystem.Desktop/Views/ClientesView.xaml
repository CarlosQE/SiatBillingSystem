<UserControl x:Class="SiatBillingSystem.Desktop.Views.ClientesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{StaticResource BgPrimary}">

    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="{Binding ModoEdicion,
                Converter={StaticResource BoolToWidthConverter320}}"/>
        </Grid.ColumnDefinitions>

        <!-- LISTA DE CLIENTES -->
        <Grid Grid.Column="0" Margin="0,0,12,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Toolbar -->
            <Border Grid.Row="0" Style="{StaticResource CardBorder}" Margin="0,0,0,10">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Margin="0,0,12,0">
                        <TextBlock Text="Buscar cliente" Style="{StaticResource FieldLabel}"/>
                        <TextBox Style="{StaticResource PosTextBox}"
                                 Text="{Binding Filtro, UpdateSourceTrigger=PropertyChanged}"
                                 Width="300" HorizontalAlignment="Left"/>
                    </StackPanel>

                    <Button Grid.Column="1" Style="{StaticResource BtnPrimary}"
                            Height="36" Padding="16,0"
                            Command="{Binding NuevoClienteCommand}"
                            VerticalAlignment="Bottom"
                            Content="+ Nuevo Cliente"/>
                </Grid>
            </Border>

            <!-- DataGrid -->
            <Border Grid.Row="1" Style="{StaticResource CardBorder}" Padding="0">
                <DataGrid Style="{StaticResource PosDataGrid}"
                          ColumnHeaderStyle="{StaticResource DataGridColumnHeader}"
                          RowStyle="{StaticResource DataGridRow}"
                          ItemsSource="{Binding ClientesFiltrados}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="NIT / CI"
                                            Binding="{Binding Nit}" Width="120"/>
                        <DataGridTextColumn Header="Nombre / RazÃ³n Social"
                                            Binding="{Binding Nombre}" Width="*"/>
                        <DataGridTextColumn Header="TelÃ©fono"
                                            Binding="{Binding Telefono}" Width="110"/>
                        <DataGridTextColumn Header="Email"
                                            Binding="{Binding Email}" Width="180"/>
                        <DataGridTextColumn Header="Facturas"
                                            Binding="{Binding TotalFacturas}" Width="70"/>
                        <DataGridTemplateColumn Header="" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Style="{StaticResource BtnOutlineSmall}"
                                            Content="Editar"
                                            Command="{Binding DataContext.EditarClienteCommand,
                                                RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>
        </Grid>

        <!-- PANEL DE EDICIÃ“N -->
        <Border Grid.Column="1"
                Visibility="{Binding ModoEdicion, Converter={StaticResource BoolToVisibility}}"
                Style="{StaticResource CardBorderAccent}">
            <StackPanel>
                <TextBlock Style="{StaticResource PageTitle}"
                           Text="{Binding ClienteSeleccionado,
                               Converter={StaticResource NullToNewEditTitle}}"
                           Margin="0,0,0,16"/>

                <TextBlock Text="NIT / CI" Style="{StaticResource FieldLabel}"/>
                <TextBox Style="{StaticResource PosTextBox}" Margin="0,0,0,10"
                         Text="{Binding EditNit, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Nombre / RazÃ³n Social" Style="{StaticResource FieldLabel}"/>
                <TextBox Style="{StaticResource PosTextBox}" Margin="0,0,0,10"
                         Text="{Binding EditNombre, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Email" Style="{StaticResource FieldLabel}"/>
                <TextBox Style="{StaticResource PosTextBox}" Margin="0,0,0,10"
                         Text="{Binding EditEmail, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="TelÃ©fono" Style="{StaticResource FieldLabel}"/>
                <TextBox Style="{StaticResource PosTextBox}" Margin="0,0,0,20"
                         Text="{Binding EditTelefono, UpdateSourceTrigger=PropertyChanged}"/>

                <Button Style="{StaticResource BtnPrimary}" Height="38"
                        Content="ðŸ’¾ Guardar Cliente"
                        Command="{Binding GuardarClienteCommand}"
                        Margin="0,0,0,8"/>

                <Button Style="{StaticResource BtnSecondary}" Height="36"
                        Content="Cancelar"
                        Command="{Binding CancelarEdicionCommand}"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>